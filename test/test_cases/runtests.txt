#to run my test cases (from the bustools folder)
#to be able to run this file, you need to run the line chmod +x ./test/test_cases/runtests.txt
mkdir tmp

#Test umicorrect
#tc0003
./build/src/bustools fromtext -p ./test/test_cases/tc0003.txt | ./build/src/bustools umicorrect -e ./test/test_cases/matrix.ec -g ./test/test_cases/transcripts_to_genes.txt -t ./test/test_cases/transcripts.txt -p  - | ./build/src/bustools text -o ./tmp/tc0003output.txt -
diff -w -B -s ./test/test_cases/tc0003ExpResult.txt ./tmp/tc0003output.txt
rm ./tmp/*
#or separately
./build/src/bustools fromtext -o ./tmp/tc3mid.bus ./test/test_cases/tc0003.txt
./build/src/bustools umicorrect -o ./tmp/tc3mid2.bus -e ./test/test_cases/matrix.ec -g ./test/test_cases/transcripts_to_genes.txt -t ./test/test_cases/transcripts.txt ./tmp/tc3mid.bus
./build/src/bustools text -o ./tmp/tc0003output.txt ./tmp/tc3mid2.bus
#check that the files are identical
diff -w -B -s ./test/test_cases/tc0003ExpResult.txt ./tmp/tc0003output.txt
rm ./tmp/*

#Test count
#tc0004
./build/src/bustools fromtext -p ./test/test_cases/tc0004.txt | ./build/src/bustools count -o ./tmp/tc0004output/ --hist -m  --genecounts -e ./test/test_cases/matrix.ec -g ./test/test_cases/transcripts_to_genes.txt -t ./test/test_cases/transcripts.txt -
./build/src/bustools fromtext -p ./test/test_cases/tc0004.txt | ./build/src/bustools count -o ./tmp/tc0004outputraw/ --hist -m  --genecounts --rawcounts -e ./test/test_cases/matrix.ec -g ./test/test_cases/transcripts_to_genes.txt -t ./test/test_cases/transcripts.txt -
diff -w -B -s ./test/test_cases/tc0004ExpResultsCount.txt ./tmp/tc0004output/output.mtx
diff -w -B -s ./test/test_cases/tc0004ExpResultsGenes.txt ./tmp/tc0004output/output.genes.txt
diff -w -B -s ./test/test_cases/tc0004ExpResultsBarcodes.txt ./tmp/tc0004output/output.barcodes.txt
diff -w -B -s ./test/test_cases/tc0004ExpResultsHist.txt ./tmp/tc0004output/output.hist.txt
diff -w -B -s ./test/test_cases/tc0004ExpResultsCU.txt ./tmp/tc0004output/output.cu.txt
diff -w -B -s ./test/test_cases/tc0004ExpResultsCountRaw.txt ./tmp/tc0004outputraw/output.mtx



#manual test of predict - requires that pbmcv2 has been processed by Kallisto and that a tr2g file exists, see the commands file for pbmcv2 for how to do this
#tc0006
mkdir ~/new_bustools/bustools/data/pbmcv2
cp /mnt/e/Butterfly/10xv2_whitelist.txt ~/new_bustools/bustools/data/
cp /mnt/e/Butterfly/pbmcv2/bus_output/matrix.ec ~/new_bustools/bustools/data/pbmcv2/ 
cp /mnt/e/Butterfly/pbmcv2/bus_output/transcripts.txt ~/new_bustools/bustools/data/pbmcv2/ 
cp /mnt/e/Butterfly/pbmcv2/bus_output/transcripts_to_genes.txt ~/new_bustools/bustools/data/pbmcv2/ 
cp /mnt/e/Butterfly/pbmcv2/bus_output/output.bus ~/new_bustools/bustools/data/pbmcv2/
cd ~/new_bustools/bustools/data/pbmcv2
mkdir tmp
~/new_bustools/bustools/build/src/bustools correct -w ../10xv2_whitelist.txt -o corr.bus output.bus
~/new_bustools/bustools/build/src/bustools sort -T tmp/ -t 4 -o sort.bus corr.bus
~/new_bustools/bustools/build/src/bustools umicorrect -e ./matrix.ec -g ./transcripts_to_genes.txt -t ./transcripts.txt -o umicorr.bus sort.bus
~/new_bustools/bustools/build/src/bustools count --hist -m --genecounts -e ./matrix.ec -g ./transcripts_to_genes.txt -t ./transcripts.txt -o count/ umicorr.bus
~/new_bustools/bustools/build/src/bustools count --downsample 0.1 --hist -m --genecounts -e ./matrix.ec -g ./transcripts_to_genes.txt -t ./transcripts.txt -o count_ds/ umicorr.bus
~/new_bustools/bustools/build/src/bustools predict -t 10 -o count_ds_pred/ count_ds/

cp -r count_ds /mnt/e/Butterfly/pbmcv2/bus_output/
cp -r count_ds_pred /mnt/e/Butterfly/pbmcv2/bus_output/
cp -r count /mnt/e/Butterfly/pbmcv2/bus_output/

#now run TestCppImplPredict.R in R
